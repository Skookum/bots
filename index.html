<!DOCTYPE html>
<html>
    <head>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script>
          var gameTurns = [];
          var turn = 0;
          var socket = io.connect('http://localhost:3000');
          var c;
          var ctx;

          window.onload = function() {
            c=document.getElementById('game');
            ctx=c.getContext('2d');
          }

          socket.on('message', function(data) {
            console.log(data);
          });
          socket.on('game', function(data) {
            console.log(data);
            gameTurns.push(data);
            $('#turns').append('<li turn='+turn+'>'+turn+'</li>');
            turn++;
          });

          $(document).on('click', 'li', function(e) {
            console.log('li clicked');
            var i = ~~$(this).attr('turn');
            showTurn(gameTurns[i]);
          });

          function showTurn(state) {
            console.log(state.grid);
            ctx.clearRect (0, 0, c.width, c.height);
            var coordWidth = c.width/state.cols;
            for(var i=1; i<state.cols; i++) {
              var x = i*coordWidth;
              ctx.beginPath();
              ctx.moveTo(x, 0);
              ctx.lineTo(x, c.height);
              ctx.stroke();
            }

            var coordHeight = c.height/state.rows;
            for(var i=1; i<state.rows; i++) {
              var y = i*coordHeight;
              ctx.beginPath();
              ctx.moveTo(0, y);
              ctx.lineTo(c.width, y);
              ctx.stroke();
            }
          }
        </script>

        <style type='text/css'>
          li {
            text-decoration:none;
            display:inline-block;
            padding:10px;
          }
          canvas {
            border:1px solid black;
          }
        </style>
    </head>
    <body>
      <canvas id='game' width=500 height=500></canvas>
      <ul id='turns'>
      </ul>
    </body>
</html>
